import { useContext, useEffect, useState } from 'react'
import { Context } from 'src/context.js'
import HeaderLink from './LinkComponent.js'
import { motion } from 'framer-motion'
import scrollToAnchor from 'src/components/Section/ScrollToAnchor.js'

export default function Header()
{
    const { last_page_progress, breakpoint_final_last_progress, popup_ids } = useContext(Context)
    const [last_header, set_last_header] = useState(false)
    
    const colors = {
        init_color: "color(display-p3 0.862745 0.854902 0.866667)",
        background_color: "color(display-p3 0.231373 0.176471 0.254902)",
        globus_color: "color(display-p3 0.000000 0.545098 0.815686)",
        wings_color: "color(display-p3 0.968627 0.690196 0.101961)"
    }

    useEffect( () => {
        last_page_progress >= breakpoint_final_last_progress ? set_last_header(true) : set_last_header(false)
    }, [last_page_progress])

    const logo_variants = {
        initial: { fill: colors.init_color, stroke: colors.init_color },
        last_initial:{ fill: colors.background_color, stroke: colors.background_color },
        tap: { scale: 0.9, transition: {ease: 'easeOut', duration: 0.025} }
    }
    const globus_variants = {
        initial: { fill: colors.init_color, stroke: colors.init_color },
        last_initial:{ fill: colors.background_color, stroke: colors.background_color },
        hover: {
            fill: colors.globus_color,
            stroke: colors.globus_color,
            transition: {ease: 'easeOut', duration: 0.25}
        },
        tap: {
            fill: colors.globus_color,
            stroke: colors.globus_color,
            transition: {ease: 'easeOut', duration: 0.025}
        }
    }
    const wings_variants = {
        initial: { fill: colors.init_color, stroke: colors.init_color },
        last_initial:{ fill: colors.background_color, stroke: colors.background_color },
        hover: {
            fill: colors.wings_color,
            stroke: colors.wings_color,
            transition: {ease: 'easeOut', duration: 0.25}
        },
        tap: {
            fill: colors.wings_color,
            stroke: colors.wings_color,
            transition: {ease: 'easeOut', duration: 0.025}
        }
    }
    const figcaption_variants = {
        initial: { y: "50%", opacity: 0 },
        last_initial: { y: "50%", opacity: 0 },
        hover: { y: "0%", opacity: 1, transition: {ease: 'easeOut', duration: 0.25} }
    }
    
    return (
        <header className={last_header ? "last_header" : ''}>
            <HeaderLink position={'left'}
            text='Отзывы'/>

            <div className='header_wrapper'>
                <motion.figure className='content_header_wrapper'
                onClick={ () => { scrollToAnchor('#main_content') }}
                animate={last_header ? "last_initial" : "initial"}
                whileHover="hover"
                whileTap="tap">
                    <motion.svg id='logo'
                    variants={logo_variants}
                    viewBox="0 0 493 375">
                        <motion.path
                        id='globus'
                        variants={globus_variants}
                        d="M222.146 0.673123C216.615 1.66964 207.156 4.18529 201.973 6.03816C187.175 11.329 175.785 17.6897 163.691 27.4158C158.457 31.625 157.63 32.8343 159.053 34.197C160.037 35.1401 167.627 38.1234 175.258 40.5665C183.692 43.2666 185.245 43.617 186.419 43.0814C186.96 42.8349 188.647 40.7834 190.167 38.523C197.344 27.8526 208.686 15.7226 219.645 6.99548C222.969 4.3484 226.144 1.69171 226.699 1.09147L227.71 -0.00012207L226.491 0.0549209C225.821 0.085371 223.865 0.363617 222.146 0.673123ZM265.523 0.662685C265.825 1.02725 268.145 2.94307 270.679 4.92024C284.385 15.6141 293.869 25.5254 302.78 38.4684C304.679 41.2272 306.103 42.8728 306.804 43.1197C307.635 43.4117 309.142 43.1389 313.229 41.9572C324.463 38.7086 334.344 34.673 334.612 33.2243C334.799 32.2157 333.298 30.6535 328.218 26.567C315.707 16.5042 299.939 8.39867 283.961 3.8178C278.208 2.16849 267.992 -0.00012207 265.974 -0.00012207C265.107 -0.00012207 265.046 0.088304 265.523 0.662685ZM236.441 6.44403C222.593 15.0689 207.773 29.111 199.23 41.7023C196.505 45.718 196.909 46.3787 202.714 47.3994C219.453 50.3422 239.492 51.8226 241.08 50.2338C241.659 49.6544 241.735 47.037 241.735 27.7429C241.735 15.7338 241.621 5.61101 241.482 5.24811C241.059 4.14398 239.566 4.49814 236.441 6.44403ZM251.336 5.39496C250.661 6.65634 250.762 48.2884 251.443 49.6378C251.943 50.6293 252.173 50.6872 256.125 50.8195C265.628 51.1369 293.188 47.721 294.893 46.015C295.787 45.1198 295.657 44.5321 294.03 42.112C285.685 29.7013 272.391 16.8601 258.263 7.56276C253.585 4.48438 252.075 4.01219 251.336 5.39496ZM149.325 41.5501C149.046 41.6732 147.521 43.4022 145.937 45.3927C136.856 56.8027 129.53 71.6895 126.081 85.7416C124.991 90.184 123.374 100.061 123.37 102.3C123.369 102.93 123.743 103.822 124.202 104.281C125.013 105.093 125.591 105.115 145.795 105.115C162.165 105.115 166.711 105.001 167.295 104.574C167.881 104.144 168.157 102.865 168.62 98.4409C170.1 84.2829 173.502 71.1464 178.769 59.2504C179.933 56.6225 180.884 53.9796 180.884 53.3769C180.884 52.027 180.283 51.6958 174.841 50.049C169.161 48.3305 162.123 45.781 156.783 43.5077C152.421 41.6506 150.34 41.1042 149.325 41.5501ZM337.596 42.9341C333.294 44.8629 322.698 48.7251 316.833 50.5025C311.153 52.2235 311.099 52.3432 313.55 57.8009C319.465 70.9753 322.362 82.2002 324.627 100.72C324.914 103.07 325.247 104.198 325.767 104.578C326.343 104.999 330.977 105.115 347.232 105.115C365.521 105.115 368.038 105.038 368.616 104.46C369.522 103.554 369.466 99.8429 368.454 93.6444C365.688 76.7025 359.001 61.2914 348.147 46.8455C343.362 40.4768 343.206 40.4189 337.596 42.9341ZM191.392 55.3194C190.047 55.9159 184.898 67.7789 182.389 76.0588C179.976 84.0255 177.55 97.1612 177.55 102.259C177.55 105.273 175.769 105.115 209.879 105.115C238.875 105.115 240.389 105.078 241.045 104.352C241.668 103.664 241.735 101.556 241.735 82.7416C241.735 65.5031 241.634 61.7552 241.15 61.0928C240.631 60.3829 239.794 60.2594 233.752 60.0024C222.666 59.5311 214.19 58.6151 203.081 56.688C194.967 55.2806 192.208 54.9573 191.392 55.3194ZM297.966 55.2343C297.717 55.4833 283.224 57.8952 278.915 58.4041C271.797 59.2454 266.02 59.7167 259.352 60.0003C253.688 60.2414 252.467 60.4083 251.85 61.0261C251.164 61.7127 251.113 63.2377 251.113 82.8476C251.113 103.237 251.139 103.951 251.922 104.523C252.603 105.022 257.522 105.115 283.042 105.115C299.714 105.115 313.665 104.996 314.045 104.85C315.259 104.384 315.519 102.799 315.081 98.5306C313.779 85.8208 310.033 72.0936 304.816 60.9105C302.534 56.0189 301.689 55.0604 299.665 55.0604C298.826 55.0604 298.062 55.1388 297.966 55.2343ZM124.202 115.126C123.218 116.111 123.205 116.498 123.971 122.218C126.608 141.909 134.439 159.836 147.234 175.471C150.664 179.662 150.708 179.671 156.42 177.291C161.964 174.982 168.545 172.607 174.424 170.795C180.209 169.013 181.301 168.434 181.301 167.15C181.301 166.638 180.297 163.967 179.069 161.216C175.154 152.44 171.591 141.038 170.076 132.437C169.297 128.011 168.381 120.451 168.381 118.442C168.381 117.099 168.111 116.148 167.517 115.391L166.653 114.292H145.844C125.591 114.292 125.013 114.314 124.202 115.126ZM178.418 114.982C177.47 115.647 177.442 115.815 177.685 119.467C178.041 124.829 179.758 134.44 181.466 140.629C183.408 147.668 185.406 152.996 188.597 159.639C190.854 164.34 191.412 165.193 192.389 165.438C193.07 165.609 195.912 165.281 199.4 164.628C210.212 162.605 222.158 161.218 232.774 160.754C238.99 160.482 240.806 160.158 241.407 159.211C241.581 158.939 241.725 149.013 241.729 137.154L241.735 115.591L240.809 114.942C239.991 114.368 236.337 114.292 209.643 114.292C182.177 114.292 179.312 114.355 178.418 114.982ZM251.757 115.405C250.891 116.507 250.883 116.73 250.998 137.707C251.101 156.807 251.181 158.964 251.805 159.588C252.348 160.131 253.791 160.357 258.474 160.63C271.816 161.408 280.813 162.391 290.916 164.173C294.239 164.76 297.558 165.343 298.291 165.47C300.834 165.91 301.535 165.421 303.333 161.953C309.694 149.686 314.914 130.707 315.215 118.748C315.286 115.941 315.184 115.399 314.489 114.887C313.805 114.385 308.937 114.292 283.156 114.292H252.632L251.757 115.405ZM325.748 114.947C324.92 115.775 324.796 116.373 324.255 122.144C323.005 135.479 319.212 149.599 313.559 161.963C312.175 164.991 311.395 167.207 311.547 167.685C311.819 168.545 312.055 168.64 322.8 172.216C326.926 173.589 332.365 175.589 334.886 176.66C340.164 178.902 340.967 179.132 342.316 178.793C344.214 178.317 352.74 166.704 357.06 158.712C362.838 148.023 366.396 137.713 368.444 125.724C369.466 119.742 369.528 115.86 368.616 114.947C368.038 114.369 365.516 114.292 347.182 114.292C328.855 114.292 326.325 114.369 325.748 114.947ZM232.774 169.793C217.635 170.876 200.383 173.221 198.978 174.389C197.82 175.35 198.391 176.828 201.538 181.008C207.912 189.477 215.689 197.359 224.808 204.591C229.717 208.485 238.021 214.111 239.567 214.591C241.769 215.274 241.735 215.617 241.735 192.532C241.735 176.079 241.615 171.017 241.213 170.466C240.514 169.509 238.732 169.367 232.774 169.793ZM252.669 169.768C252.15 169.986 251.536 170.664 251.304 171.275C250.673 172.934 250.957 213.788 251.603 214.434C252.407 215.238 253.892 214.585 259.098 211.138C271.739 202.768 282.577 192.647 291.597 180.79C295.105 176.18 295.401 175.036 293.312 174.174C290.17 172.878 272.525 170.544 261.532 169.971C259.011 169.839 256.197 169.651 255.281 169.552C254.364 169.454 253.189 169.551 252.669 169.768ZM177.603 179.404C168.419 182.215 160.156 185.468 159.613 186.485C159.024 187.585 159.546 188.432 162.21 190.697C175.09 201.649 191.645 210.414 208.849 215.389C221.683 219.101 228.135 219.621 225.226 216.71C224.856 216.34 223.028 214.886 221.162 213.477C209.921 204.993 198.599 193.238 190.716 181.866C189.364 179.916 187.969 178.086 187.617 177.799C186.55 176.93 184.728 177.222 177.603 179.404ZM305.606 177.555C305.319 177.671 303.97 179.392 302.608 181.38C294.442 193.304 284.286 203.831 271.182 213.956C266.921 217.248 265.904 218.525 267.471 218.615C271.282 218.837 280.671 216.704 290.29 213.433C303.916 208.799 317.4 201.379 328.746 192.273C333.333 188.591 334.127 187.358 332.753 186.05C331.535 184.891 323.199 181.773 313.294 178.77C308.64 177.359 306.808 177.069 305.606 177.555Z"> </motion.path>

                        <motion.path
                        id='wings'
                        variants={wings_variants}
                        d="M23.1486 117.286C19.3447 125.167 15.7795 134.094 12.9332 142.865C10.4125 150.634 6.25177 166.746 6.25177 168.739C6.25177 170.408 9.2047 177.571 12.3468 183.524C20.7938 199.528 32.9648 212.904 49.2186 224.045C53.2814 226.83 54.721 228.167 53.6548 228.167C51.17 228.167 37.3318 221.842 31.1543 217.882C21.3706 211.611 13.0153 203.533 6.67771 194.218C2.93415 188.715 2.25527 189.523 1.28291 200.637C0.597716 208.468 0.681866 234.924 1.39749 236.628C2.627 239.555 13.8431 249.211 21.502 253.935C37.8449 264.016 53.1034 268.934 79.3975 272.595C82.1483 272.978 84.6803 273.394 85.0241 273.519C85.368 273.644 84.4302 274.003 82.9402 274.315C72.0254 276.604 48.2499 274.339 31.2589 269.392C24.7178 267.487 15.692 263.969 9.90616 261.068C5.47699 258.848 4.35664 258.616 3.9682 259.841C3.29009 261.98 10.4846 292.103 12.8416 296.993C14.5675 300.573 27.2256 304.775 41.6785 306.566C46.226 307.13 63.1587 307.134 68.0972 306.572C70.1861 306.335 73.6771 305.942 75.8548 305.701C80.209 305.217 89.1653 303.864 92.1094 303.246C93.141 303.029 97.1118 302.191 100.934 301.382C104.755 300.574 108.406 299.913 109.046 299.913C110.103 299.913 110.15 299.973 109.556 300.567C108.605 301.519 98.1899 305.783 89.8084 308.652C74.3377 313.948 63.618 316.318 49.9321 317.465C42.9863 318.047 35.3796 317.568 28.3414 316.105C26.1637 315.652 23.5108 315.181 22.4459 315.057C19.4872 314.713 19.4718 315.521 22.3151 321.915C25.8148 329.786 26.3888 330.671 28.3314 331.195C29.4484 331.496 44.2572 331.599 74.8975 331.521L119.826 331.406L130.454 325.749C141.337 319.956 144.532 318.452 144.987 318.908C145.13 319.051 144.497 319.835 143.581 320.651C133.808 329.357 133.024 330.352 135.274 331.208C136.739 331.765 356.317 331.765 357.783 331.208C359.909 330.398 359.076 329.267 351.137 322.174C345.337 316.992 346.911 317.495 362.811 325.899L373.231 331.406H419.148H465.065L466.11 330.423C467.166 329.43 472.483 318.349 472.643 316.806C472.88 314.527 472.468 314.491 464.715 316.108C457.859 317.538 449.799 318.032 442.751 317.456C429.673 316.387 416.774 313.485 401.989 308.285C395.717 306.079 387.146 302.626 384.548 301.259C382.446 300.152 382.427 300.125 383.652 300.002C384.341 299.932 387.541 300.438 390.763 301.125C402.566 303.645 409.337 304.816 417.41 305.735C419.702 305.996 423.078 306.389 424.912 306.607C429.458 307.15 446.87 307.109 451.539 306.546C460.511 305.462 468.578 303.486 474.493 300.922C479.325 298.827 479.881 298.148 481.802 291.998C485.003 281.749 489.052 263.675 488.805 260.733C488.621 258.536 487.597 258.63 482.207 261.336C464.375 270.285 442.968 275.094 420.953 275.094C414.543 275.094 407.03 274.246 407.447 273.569C407.567 273.375 408.183 273.217 408.817 273.217C409.451 273.217 411.643 272.947 413.69 272.618C415.736 272.288 419.004 271.802 420.953 271.536C436.619 269.402 453.221 264.149 465.34 257.493C473.89 252.798 483.42 245.717 489.242 239.734C491.444 237.471 491.476 237.403 491.902 233.953C492.819 226.52 492.378 207.103 491.005 194.46C490.449 189.342 489.612 189.379 485.971 194.681C477.774 206.621 467.475 215.406 453.167 222.666C450.006 224.27 445.678 226.189 443.55 226.931C437.495 229.044 437.796 228.203 444.882 223.205C452.2 218.043 455.789 215.051 461.412 209.426C467.357 203.477 470.385 199.815 474.908 193.102C478.185 188.237 483.738 177.636 485.782 172.344L486.962 169.287L486.218 165.704C484.126 155.631 479.473 140.189 475.609 130.495C472.836 123.539 467.846 112.716 466.959 111.736C465.369 109.978 464.703 110.837 463.684 115.961C457.083 149.155 442.495 173.394 418.048 191.785C403.027 203.086 385.759 211.605 350.516 225.104C326.785 234.193 316.659 238.476 304.875 244.409C288.964 252.42 278.559 259.667 269.413 269.11C258.587 280.288 251.919 291.937 248.381 305.857C246.947 311.498 246.257 312.405 245.526 309.611C245.301 308.751 244.727 306.498 244.251 304.606C242.394 297.23 238.939 289.577 234.238 282.427C230.48 276.71 227.568 273.175 222.344 267.987C207.042 252.787 190.494 243.75 147.125 226.908C114.204 214.124 103.026 209.212 90.6236 202.083C67.7051 188.908 51.6701 172.615 41.3559 152.021C35.6301 140.589 33.1048 132.909 28.6098 113.249C28.2263 111.572 27.9471 111.138 27.1835 111.029C26.3362 110.909 25.9015 111.583 23.1486 117.286Z"> </motion.path>
                            
                        <path d="M1.66714 343.583C0.283414 344.078 0 345.098 0 349.584C0 353.357 0.123414 354.199 0.796938 355.031L1.59337 356.016L111.974 356.227C172.684 356.344 222.364 356.485 222.374 356.54C222.384 356.596 223.207 358.234 224.202 360.179C227.651 366.924 232.461 370.972 240.082 373.54C246.726 375.78 249.111 375.564 256.674 372.043C261.584 369.758 265.993 365.439 268.628 360.333C269.675 358.303 270.571 356.596 270.617 356.54C270.664 356.485 320.528 356.344 381.428 356.227C442.327 356.111 492.302 355.868 492.483 355.687C493.044 355.125 493.209 345.193 492.673 344.191L492.194 343.294H376.388C263.087 343.294 260.562 343.311 259.602 344.089C258.729 344.796 258.592 345.341 258.372 348.991C258.017 354.872 256.353 357.841 252.085 360.207C250.137 361.287 249.45 361.438 246.528 361.431C243.727 361.424 242.852 361.243 241.053 360.301C238.407 358.914 236.121 356.306 235.326 353.767C234.995 352.71 234.618 350.25 234.488 348.299C234.292 345.357 234.101 344.63 233.363 344.024C232.521 343.332 226.405 343.296 117.383 343.327C54.0832 343.345 2.01099 343.46 1.66714 343.583Z"></path>
                    </motion.svg>
                    
                    <motion.figcaption
                    variants={figcaption_variants}>
                        Inspiration
                    </motion.figcaption>
                </motion.figure>
            </div>

            <HeaderLink position={'right'}
            text='Частые вопросы'/>

            <div className='header_wrapper hamburger_wrapper'>
                <motion.svg className='content_header_wrapper'
                viewBox="0 0 44 32"
                variants={logo_variants}
                animate={last_header ? "last_initial" : "initial"}
                whileTap="tap"
                onClick={ () => {
                    let popup = document.querySelector(`#${popup_ids.FullViewPopup}`)
                    popup.show()
                } }>
	                <path d="M10.5473 0.268673H41.5163C44.8279 0.176652 44.8279 3.83998 41.5163 3.74796H10.6707C7.41939 3.83998 7.29294 0.268673 10.5443 0.268673H10.5473ZM41.5163 14.1814C44.7014 14.1814 44.7014 17.6585 41.5163 17.6585H24.0554C20.8041 17.6585 20.8041 14.1814 24.0554 14.1814H41.5163ZM41.5163 28.0942C44.7014 28.0942 44.7014 31.5713 41.5163 31.5713H2.38883C-0.796277 31.5713 -0.796277 28.0942 2.38883 28.0942H41.5163Z"/>
                </motion.svg>
            </div>
        </header>
    )
}